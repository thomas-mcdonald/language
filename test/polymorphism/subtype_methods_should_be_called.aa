comment: subtype methods should be called even if we think we have type a
executable: true
#-#-#
class A
  def print
    puts 1
  end
end

class B < A
  def print
    puts 2
  end
end

class Main
  A a
  A b

  def main
    a = new A
    b = new B
    a.print
    b.print
  end
end
#-#-#
MODULE Program 0 0
ENDHDR

PROC A.print 0 0 0
CONST 1
GLOBAL Lib.Print
CALL 1
RETURN
END

PROC B.print 0 0 0
CONST 2
GLOBAL Lib.Print
CALL 1
RETURN
END

PROC Main.main 0 0 0
CONST 4
GLOBAL A
LOCAL 12
LOADW
CONST 4
PLUS
GLOBAL Lib.New
CALL 3
CONST 4
GLOBAL B
LOCAL 12
LOADW
CONST 8
PLUS
GLOBAL Lib.New
CALL 3
LOCAL 12
LOADW
CONST 4
PLUS
LOADW
! method address for A.print
LOCAL 12
LOADW
CONST 4
PLUS
LOADW
LOADW
CONST 4
PLUS
LOADW
CALL 1
LOCAL 12
LOADW
CONST 8
PLUS
LOADW
! method address for A.print
LOCAL 12
LOADW
CONST 8
PLUS
LOADW
LOADW
CONST 4
PLUS
LOADW
CALL 1
RETURN
END

PROC Program.%main 4 0 0
CONST 12
GLOBAL Main
LOCAL -4
GLOBAL Lib.New
CALL 3
LOCAL -4
LOADW
GLOBAL Main.main
CALL 1
RETURN
END


DEFINE Object
! Descriptor for A
DEFINE A
WORD 0
WORD A.print
DEFINE A.%super
WORD Object
WORD A

! Descriptor for B
DEFINE B
WORD 0
WORD B.print
DEFINE B.%super
WORD Object
WORD A
WORD B

! Descriptor for Main
DEFINE Main
WORD 0
WORD Main.main
DEFINE Main.%super
WORD Object
WORD Main
#-#-#
1 2